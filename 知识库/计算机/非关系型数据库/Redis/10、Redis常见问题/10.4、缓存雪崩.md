> 标签： [[Redis]] [[Redis常见问题]] [[Redis面试问题]]

> 问题描述

相近时间内大量的Redis的key相继过期，导致请求大量到达数据库，导致服务器压力过大甚至宕机

![[Pasted image 20230413175248.png]]

> 问题现象

-   相近时间内大量的Redis的key相继过期
-   数据库压力变大
-   服务器崩溃

> 解决方案

-   构建多级缓存架构：nginx缓存 + redis 缓存 ＋其他缓存(ehcache等)
-   使用锁或队列：用加锁或者队列的方式保证来保证不会有大量的线程对数据库一次性进行读写，从而避免失效时大量的并发请求落到底层存储系统上。不适用高并发情况
-   设置过期标志更新缓存：记录缓存数据是否过期（设置提前量），如果过期会触发通知另外的线程在后台去更新实际 key 的缓存
-   将缓存失效时间分散开：可以在原有的失效时间基础上增加一个随机值，这样每一个缓存的过期时间的重复率就会降低，就很难引发集体失效的事件