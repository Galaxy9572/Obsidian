> 标签： [[Redis]] [[Redis常见问题]] [[Redis面试问题]]

> 问题描述

Redis中key 对应的数据存在，但已过期，此时若有大量并发请求过来，这些请求发现缓存过期一般都会从数据库加载数据并加载到缓存，这个时候大并发的请求可能会瞬间把数据库压垮

![](https://secure2.wostatic.cn/static/uxjSpT68a65bpiwghKCkCL/image.png?auth_key=1681379439-rPyCpAJtFXErNWKiaKCFpo-0-bdb627acf2fedccc6ef2fe738c227568)

> 问题现象

-   数据库访问压力瞬时增加
-   Redis里面没有出现大量key过期
-   Redis正常运行

> 解决方案

-   预先设置热门数据：在Redis 高峰访问之前，把一些热门数据提前存入到Redis 里面，加大这些热门数据 key 的时长
-   实时调整：现场监控哪些数据热门，实时调整 key 的过期时长
-   使用锁：
    1.  在缓存失效的时候，不是立即去加载数据库
    2.  先使用缓存工具的某些带成功操作返回值的操作（比如 Redis 的 SETNX)去加锁，当操作返回成功时，再进行加载数据库的操作，并存到缓存，最后解锁
    3.  当操作返回失败，证明有线程在加载数据库，当前线程睡眠一段时间再重试整个get 缓存的方法