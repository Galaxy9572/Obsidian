> 在指定的**时间间隔**内将內存中的数据集快照(Snapshot)写入磁盘，它恢复时是将快照文件直接读到内存里，默认文件名为dump.rdb，可在redis.conf中修改**dbfilename**属性自定义，在redis启动时会自动加载dump.rdb文件进行恢复

> 标签： #Redis #Redis持久化

RDB默认是启动的，如果RDB和AOF同时开启，那么Redis会取AOF的数据

### 6.1.1、备份执行流程

> 通过redis内部的定时器和lastsave时间戳定期执行保存操作

1.  Redis 会**单独创建(fork)一个子进程**
2.  先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件昔换上次持久化好的文件。
3.  整个过程中，主进程是不进行任何I/O操作的，这就确保了极高的性能

### 6.1.2、fork()

Fork 是复制一个与当前进程一样的进程。新进程的所有数据（变量、环境变量、程序计数器等）数值都和原进程一致，但是是一个全新的进程，井作为原进程的子进程。 在Linux 程序中，fork()会产生一个和父进程完全相同的子进程，但子进程在此后多会exec系统调用，出于效率考虑，Linux 中引入了“写时复制技术”。 一般情况父进程和子进程会共用同一段物理内存，只有进程空间的名段的内容要发生变化时，才会将父进程的内容复制一份给子进程。

### 6.1.3、RDB的配置

### 6.1.4、save、bgsave命令

可以在命令行中手动调用save或bgsave进行备份

`save`和`bgsave`两个命令都会调用 `rdbSave` 函数，但它们调用的方式各有不同

`save`直接调用 `rdbSave` ，阻塞 Redis 主进程，直到保存完成为止。在主进程阻塞期间，服务器不能处理客户端的任何请求。`bgsave` 则 fork 出一个子进程，子进程负责调用`rdbSave` ，并在保存完成之后向主进程发送信号，通知保存已完成。 Redis 服务器在`bgsave` 执行期间仍然可以继续处理客户端的请求。

### 6.1.5、动态禁用RDB

通过命令行实现

```Bash
redis-cli config set save ""
```

### 6.1.6、RDB优缺点

优点：
-   如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比 AOF方式更加的高效
-   恢复速度快，占用存储空间小
- 可以进行定期备份，这有助于保存不同时间不同版本的数据

缺点：
-   fork操作将数据复制了一份，导致2倍的内存消耗
-   如果在一个备份周期内修改了多条数据但还没到达触发保存备份的条件时redis宕机，那么这些数据会全部丢失

### 6.1.7、RDB的配置

![[3.8、SNAPSHOTTING]]